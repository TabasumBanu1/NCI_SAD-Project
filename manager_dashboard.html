<!DOCTYPE html>
<html>
<head><title>Manager Dashboard</title></head>
<body>
<h2>Senior Manager Dashboard</h2>

<h3>Create Vacancy</h3>
<input id="title" placeholder="Vacancy Title" />
<textarea id="description" placeholder="Vacancy Description"></textarea>
<button onclick="createVacancy()">Create</button>

<h3>Applications Received</h3>
<div id="applicationList"></div>

<script>
async function createVacancy() {
  const title = document.getElementById("title").value;
  const description = document.getElementById("description").value;
  await fetch("api/create_vacancy.php", {
    method: "POST",
    body: JSON.stringify({ title, description })
  });
  alert("Vacancy created!");
  loadApplications();
}

async function loadApplications() {
  const res = await fetch("api/get_applications_by_manager.php");
  const apps = await res.json();
  let html = "<ul>";
  apps.forEach(a => {
    html += `<li>${a.employee_name} applied for ${a.title} â€” Status: ${a.status}
     <button onclick="updateStatus(${a.id}, 'approved')">Approve</button>
     <button onclick="updateStatus(${a.id}, 'rejected')">Reject</button>
    </li>`;
  });
  html += "</ul>";
  document.getElementById("applicationList").innerHTML = html;
}

async function updateStatus(appId, status) {
  await fetch("api/update_application_status.php", {
    method: "POST",
    body: JSON.stringify({ application_id: appId, status })
  });
  loadApplications();
}

loadApplications();
</script>
</body>
</html>