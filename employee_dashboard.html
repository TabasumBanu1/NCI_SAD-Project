<!DOCTYPE html>
<html>
<head><title>Employee Dashboard</title></head>
<body>
<h2>Employee Dashboard</h2>

<h3>Available Vacancies</h3>
<div id="vacancyList"></div>

<h3>Your Applications</h3>
<div id="applicationStatus"></div>

<script>
async function loadVacancies() {
  const res = await fetch("api/get_vacancies.php");
  const vacancies = await res.json();
  let html = "<ul>";
  vacancies.forEach(v => {
    html += `<li>${v.title} — ${v.description}
      <button onclick="apply(${v.id})">Apply</button></li>`;
  });
  html += "</ul>";
  document.getElementById("vacancyList").innerHTML = html;
}

async function apply(id) {
  await fetch("api/apply_vacancy.php", {
    method: "POST",
    body: JSON.stringify({ vacancy_id: id })
  });
  alert("Application submitted!");
  loadApplications();
}

async function loadApplications() {
  const res = await fetch("api/get_applications_by_employee.php");
  const apps = await res.json();
  let html = "<ul>";
  apps.forEach(a => {
    html += `<li>${a.title} — Status: ${a.status}</li>`;
  });
  html += "</ul>";
  document.getElementById("applicationStatus").innerHTML = html;
}

loadVacancies();
loadApplications();
</script>
</body>
</html>